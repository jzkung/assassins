<% require 'digest/sha1' %>

<% pass = "test" %>



<% if session[:current_user_id].nil? %>
  	<% content_for :title, "Welcome to Assassins" %>
  	<%= link_to "Sign In", controller: :users, action: :login %> or <%= link_to "Sign Up", controller: :users, action: :new %>!
<% else %>
<% @current_user = User.find(session[:current_user_id]) %>
<% if @current_user.is_admin? %>
  	<% content_for :title, "Game Manager" %>
	<% @games.each do |game| %>
		<h3><%= game.name %></h3>
		<% if game.is_started? %>
			<div class="row">
				<div class="col-md-3">
					<p><b>Alive</b></p>
					<% @users.each do |user| %>
						<% if !user.is_admin? && user.game_id == game.id%>
							<% if user.status == "alive" %>
								<p><%= user.first_name %> <%= user.last_name %> </p>
							<% end %>
						<% end %>
					<% end %>
				</div>
				<div class="col-md-3">
					<p><b>Dead</b></p>
					<% @users.each do |user| %>
						<% if !user.is_admin? && user.game_id == game.id%>
							<% if user.status == "dead" %>
								<p><%= user.first_name %> <%= user.last_name %> </p>
							<% end %>
						<% end %>
					<% end %>
				</div>
				<div class="col-md-3">
					<p><b>Kills</b></p>
					<% @kills.each do |kill| %>
						<p>
						Assassin: <%= kill.assassin.first_name %> <%= kill.assassin.last_name %>
						<br>
						Target: <%= kill.target.first_name %> <%= kill.target.last_name %>
						<br>
						Time Stamp: <%= kill.time_killed.to_formatted_s(:long_ordinal) %>
						</p>
					<% end %>
				</div>
				<div class="col-md-3">
					<p><b>To Be Terminated</b></p>
					<% @users.each do |user| %>
						<% if !user.is_admin? && user.game_id == game.id && user.status == "alive"%>
							<% if DateTime.now > user.term_date %>
								<p><%= user.first_name %> <%= user.last_name %> </p>
								<% url = "kills/terminate?id=" + user.id.to_s %>
								<%= form_tag(url) do |f| %>
										<button class="btn btn-lg btn-primary btn-block" type="submit">Terminate!</button> <br>
								<% end %>
							<% end %>
						<% end %>
					<% end %>
				</div>
			</div>
		<% else %>
			<div class="row"><div class="col-md-3">
				<% url = "games/start?id=" + game.id.to_s %>
				<%= form_tag(url) do |f| %>
	  				<button class="btn btn-lg btn-primary btn-block" type="submit">Start Game!</button>
				<% end %>
			</div></div>
		<% end %>
	<% end %>
<% elsif @current_user.game_id.blank? %>
	<p> You haven't signed up for a game yet.</p>
		<p> Click <%= link_to "Join Game", controller: :games, action: :new %> to join a game </p>

<% elsif !@current_user.game.is_started %>
	<p> Your game, <%= @current_user.game.name %>, has not started yet. </p>
	<p> Prepare yourself for the battle. </p>
	<p> You will receive an email when the game begins and can check here periodically for its status. </p>
	<p> And don't forget your kill code: <b><%= @current_user.kill_code %>. </p>

<% elsif @current_user.status == "dead" %>
	<p> Thank you for playing assassins. </p>
	<p> We wish you better luck in the next round. </p>

<% elsif @current_user.target == @current_user %>
	<h3>
		<p>YOU WON!!</p>
		<p>CONGRATULATIONS!!</p>
	</h3>
		
<% else %>
	<p> It is currently <%= DateTime.now.to_formatted_s(:long_ordinal) %>. </p>
		<% if DateTime.now > @current_user.term_date %>
			<p> You are currently a target for the terminators! </p>
			<p> Kill your target as soon as possible before they kill you! </p>
			<p> Your target is: <b><%= @current_user.target.first_name %> <%= @current_user.target.last_name %></b>. </p>
			<p> Your kill code is: <b><%= @current_user.kill_code %></b>. </p>
		<% else %>
			<p> Your target is: <b><%= @current_user.target.first_name %> <%= @current_user.target.last_name %></b>. </p>
			<p> Your kill code is: <b><%= @current_user.kill_code %></b>. </p>
			<p> You have until <%= @current_user.term_date.to_formatted_s(:long_ordinal) %> before the terminators come after you. </p>
			<p> Kill your target to extend the deadline! </p>
		<% end %>
<% end %>
<% end %>